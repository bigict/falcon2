{% extends "layout.html" %}

{% block title %}server - ProDesign checking {% endblock %}

{% block meta %}
{{ super() }}
{% if job.status != "Done" %}
<meta http-equiv="refresh" content="{{ refresh | default(30) }}" >
{% endif %}
{% endblock %}

{% block content %}

<div class="zerif_full_site_wrap"><div class="fadein-slider"><div class="slide-item" style="background:#fff"></div></div><div class="zerif_full_site">
<section id="home"  style="color:rgba(0,0,0,0.8); text-align:justify">
    <div class="overlay" style="background:#fff;padding-top: 8px;padding-bottom: 3px;">
        <div class="container" style="background:#fff;" >
            <div class="row">
                <div class="col-md-8 wow fadeIn"  data-wow-delay="0.3s">

        
        <h2>FALCON<big>2</big>/ProDesign - Checking</h2>
        <!-- Specifications of the Job -->
        <div class="block">
            <table>
                <tr><th bgcolor="#33ccff"><h4><font color="white">&nbsp Job information</font></h4></th></tr>
            </table>
{% if job %}
            <div class="row">
                <div class="left" style="text-align: left; position: absolute;"><label>Job ID: </label> </div>
                <div class='right' style='right: 100px; position: relative'>
                    <select id="job_select" style="font-size:100%">
                    <option selected>{{ job.job_id }}</option>
                    </select>
                    &nbsp;&nbsp;<a href="{{ module }}/submit/{{ job.job_id }}/">Resubmit</a>
                </div>
                <script type="text/javascript">  
                    var myVar = setInterval(function(){ myTimer() }, 1000);
                    function myTimer() {
                        var d = document.getElementById('num').innerHTML.replace(" seconds", "");
                        var t = Number(d) - 1 ;
                        if (t > 0)
                        {
                            document.getElementById("num").innerHTML = t;
                            d = t
                        }
                        else{
                            clearInterval(myVar);
                        }
                    }
                </script>
                <script>
                    $(function() {
                        var job_select=$("#job_select");
                        job_ids = window.localStorage.getItem("prodesign_job_id")
                        if (job_ids) {
                            job_ids = JSON.parse(job_ids);
                            $.each(job_ids, function(key, value) {
                                if ($.trim(key) != "" && key != "{{ job.job_id }}") {
                                    $("<option>" + key + "</option>").appendTo(job_select);
                                }
                            });
                        } else {
                            job_ids = {};
                        }

                        job_ids["{{job.job_id}}"] = 1;
                        window.localStorage.setItem("prodesign_job_id", JSON.stringify(job_ids));

                        $(job_select).on('change', function(e) {
                            var s = e.target;
                            var id = s.options[s.selectedIndex].text;
                            if (id != "") {
                                window.location.href="{{ module }}/checking/" + id ;
                            }
                        });
                    });
                </script>
            </div>
            <br>

            <div class="row">
                <div class="left" style="text-align: left; position: absolute;"><label> Submission Time: </label> </div>
                <div class="right" style="right: 100px; position: relative;">{{ job.time_create }}</div>
            </div>
    {% if job.time_run %}
            <div class="row">
                <div class="left" style="text-align: left; position: absolute;"><label> Running Time: </label> </div>
                <div class="right" style="right: 100px; position: relative;">{{ job.time_run }}</div>
            </div>
    {% endif %}
    {% if job.time_done %}
            <div class="row">
                <div class="left" style="text-align: left; position: absolute;"><label> Finished Time: </label> </div>
                <div class="right" style="right: 100px; position: relative;">{{ job.time_done }}</div>
            </div>
    {% endif %}
{% endif %}
        </div>
        <br>
        <br>
        <!-- End of specification -->
        
        <!-- Waiting for results -->
        <div class="block">
                <table>
                    <tr><th bgcolor="#33ccff"><h4><font color="white">&nbsp Job status</font></h4></th></tr>
                </table>
                <div class="row">
                    <p>    <strong>Your job is currently being processed, please be patient. The results of your job will appear in this browser window!
                    </strong>
                    <br />(You may <a href="javascript:void(0);" title="bookmark" onclick="addFavorite(window.location, document.title);">bookmark</a> this page to view your results later if you wish.)</p>
                </div>

                <div class="row">
                    <div class="left" style="text-align: left; position: absolute;"><label> Current Status:</label></div>
                    <div class="right {{ status_css(job.status) }}"  style="right: 100px; position: relative;">{{ job.status }}</div>
                </div>
{% if job.status != "Done" %}
            <form action="">
                <br>                
                <div class = "row">
                    <div class="left" style="text-align: left; position: absolute;"><label> Next Check:</label></div>
                    <div class="right" style="right: 100px; position: relative;" id="num">30 seconds</div>
                </div>    
                 <br>    
                <div class = "row" style="right: 100px; position: relative;">
                    <div id="check_">
                        <input type="hidden", name="id", value="{{ job.job_id }}"/>
                        <input type="submit" name="check" style="background-color:#00cc99; padding:8px 10px 8px 10px; font-size:12px; color:white" value="Check Now"> </input>
                    </div>
                </div>
            </form>
{% endif %}
        </div>

        <div class="block"> <!-- List all tasks begin -->
            <table>
                <tr><th bgcolor="#33ccff"><h4><font color="white">&nbsp Status of each protein</font></h4></th></tr>
            </table>

        <table>
            <tr>
                <td> Protein ID </td>
                <td> Submission Time </td>
                <td> Start Time </td>
                <td> End Time </td>
                <td> Status </td>
            </tr>
            <tr>
{% if job  %}
            <td> {{ job.id }} </td>
            <td> {% if job.time_create %} {{ job.time_create }} {% else %} -- {% endif %}</td>
            <td> {% if job.time_run %} {{ job.time_run }} {% else %} -- {% endif %}</td>
            <td> {% if job.time_done %} {{ job.time_done }} {% else %} -- {% endif %}</td>
            <td class="{{ status_css(job.status) }}"> {{ job.status }} </td>
            </tr>
        </table>
        {% endif %}
        
        </div> <!-- List all tasks end -->      
        <!-- End of waiting -->
        <div class="block">
            <table>
                <tr><th bgcolor="#33ccff"><h4><font color="white">&nbsp Sequence Results</font></h4></th></tr>
            </table>
        <table>
            <tr>
                <td> Sequence </td>
                <td> profold </td>
            </tr>
            <tr>
                <div class="row">
                    <td style="width:900px;word-break:break-all"><p> {% if job %} {{ job.sequences }} {% else %} -- {% endif %}</p></td>
                    <td> {% if job.status == "Done" %}
                    <a href="{{ module }}/submit_profold/{{ job.job_id }}/{{ job.id }}" title="head">check <br>profold</a>
                    {% else %}
                                --
                    {% endif %}</td>
                </div>
                            
            </tr>
        </table>
            
        </div>

        <!-- Begin of Status Log -->
        <div class="block">
            <table>
                <tr><th bgcolor="#33ccff"><h4><font color="white">&nbsp Job logs</font></h4></th></tr>
            </table>
            <div class="statuslog">
            {% if job %}{{ job.logs }}{% endif %}
            </div>
        </div>
        <!-- End of Status Log -->

    </div>
        <div class="col-md-4 wow fadeIn" align="center" data-wow-delay="0.3s" >

        <br>
        <h4 align="left"><b> SERVER STATUS</b></h4>
        <table id="jobtable" class="table">
            <tbody><tr class="{{ status_css('Queuing') }}">
            <td class="q"></td>
            <td style="width: 50px; border-right-width: 0px; background-color: pink;" > </td>
            <td style="text-align: justify; "><font size="2px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Queuing</font></td>
            <td style="text-align: justify; "><font size="2px">{% if job_status.Queuing %}{{ job_status.Queuing }}{% else %} 0 {% endif %}</font></td>
            </tr>
            <tr class="{{ status_css('Running') }}">
            <td class="r"></td>
             <td style="width: 10px; border-right-width: 0px; background-color: yellow;" > </td>
            <td style="text-align: justify; "><font size="2px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Running</font></td>
            <td style="text-align: justify; "><font size="2px">{% if job_status.Running %}{{ job_status.Running }}{% else %}0{% endif %}</font></td>
            </tr>
            <tr class="{{ status_css('Done') }}">
            <td class="d"></td>
               <td style="width: 5px; border-right-width: 0px; background-color: green;" > </td>
            <td style="text-align: justify; "><font size="2px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Done</font></td>
            <td style="text-align: justify; "><font size="2px">{% if job_status.Done %}{{ job_status.Done }}{% else %}0{% endif %}</font></td>
            </tr>
            <tr class="{{ status_css('Error') }}">
            <td class="e"></td>
            <td style="width: 5px; border-right-width: 0px; background-color: red;" > </td>
            <td style="text-align: justify; "><font size="2px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error</font></td>
            <td style="text-align: justify; "><font size="2px">{% if job_status.Error %}{{ job_status.Error }}{% else %}0{% endif %}</font></td>
            </tr>
            </tbody>
        </table>
        <br>
        <h4 align="left"><b>COOPERATIVE PARTNERS</b></h4>
        <ul class="sponsors" style="margin:0; list-style-type:none">
            <img src="{{ module }}/images/lw.jpeg" style="margin-top:5px" lt="img" width="250px" height="34" />
            <li class="sponsors"><a href="http://www.itp.cas.cn/" title="ITP"> Institute of Theoretical Physics </a></li>
            <img src="{{ module }}/images/gw.jpeg" style="margin-top:5px" alt="img" width="200px" height="34" />
            <li class="sponsors"><a href="http://www.ihep.cas.cn/" title="IHEP">Institue of High Energy Physics</a></li>
            <img src="{{ module }}/images/cas.jpeg" style="margin-top:5px" alt="img" width="200px" height="34" />
            <li class="sponsors"><a href="http://casathome.ihep.ac.cn/" title="CAS@home">CAS@home</a></li>
            <img src="{{ module }}/images/chk.jpeg" style="margin-top:5px"  alt="img" width="150px" height="30" />
            <li class="sponsors"><a href="http://www.cityu.edu.hk/" title="CUHK">City University of Hong Kong</a></li>
            <img src="{{ module }}/images/msl.png" style="margin-top:5px"  align="middle" alt="img" width="57" height="34" /> </center>
            <li class="sponsors"><a href="http://missouri.edu/" title="UM">University of Missouri</a></li>
        </ul>
        <br>
        <h4 align="left"><b>SPONSORS</b></h4>
        <ul class="sponsors" style="margin:0; list-style-type:none">
            <img src="{{ module }}/images/nsfc.jpeg" style="margin-top:5px"  alt="img" width="200" height="34" />
            <li class="sponsors"><a href="http://www.nsfc.gov.cn/" title="NSFC">National Natural Science Foundation of China</a></li>
            <img src="{{ module }}/images/973.jpeg" style="margin-top:5px"  alt="img" width="80" height="40" align="middle" />
            <li class="sponsors"><a href="http://www.973.gov.cn/AreaAppl.aspx" title="973">The National Basic Research Program (973 Program) </a></li>
        </ul>
        </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
